<?xml version="1.0" encoding="utf-8"?>
<project name="tools" default="help" basedir=".">

   <dirname property="up-one" file="${basedir}"/>
   <property name="import.dir" value="${up-one}/antlib/resources"/>
   <import file="${import.dir}/global.xml"/>
   <property name="deps.buildlist.dir" value="${omero.home}/components/tools/"/>
   <import file="${import.dir}/dependencies.xml"/>
   <import file="${import.dir}/multiproject.xml"/>
   <import file="${import.dir}/lifecycle.xml"/>
   
	<target name="help" description="This help message">
		<echo>
			The tools/ directory is a special repository
			for loosely coupled OMERO components. Each of
			these tools depends on a completed "dist" of
			OMERO.
		</echo>
	</target>

	<target name="build"
		description="Calls 'tools-build' on all components to fill target"
		depends="deps-buildlist">
		<mkdir dir="${tools.classes}"/>
		<iterate target="tools-dist"/>
	</target>

	<target name="dist" description="Copies target onto an existing dist">
		<copy todir="../../dist" overwrite="true">
			<fileset dir="target" includes="*.war,lib/**/*,client/**/*,include/**/*" followsymlinks="false"/>
		</copy>
		<mkdir dir="${tools.classes}/META-INF"/>
		<echo file="${tools.classes}/META-INF/README.txt">
			This jar was created by the tools/build.xml script's dist target
			and contains non-core classes, including both server and client
			side code for use with OMERO.
		</echo>
		<mkdir dir="${dist.dir}/blitz/"/>
		<jar update="true" destfile="${dist.dir}/blitz/services.jar" basedir="${tools.classes}" includes="**/*"/>
		<!-- This must be reworked upstream -->
		<jar update="true" destfile="${dist.dir}/${product.final.name}" basedir="${dist.dir}/blitz" includes="services.jar"/>
	</target>

	<target name="clean"
		depends="deps-buildlist"
		description="Calls 'tools-clean' on all components.">
	  	<iterate target="tools-clean"/>
		<delete dir="${tools.dest}"/>
	</target>

	<target name="findbugs"
		depends="deps-buildlist">
	  	<iterate target="findbugs"/>
	</target>

</project>
