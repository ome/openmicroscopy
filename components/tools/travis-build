#!/bin/sh
# This script is used for testing the build, primarily for use
# with travis, but may be used by hand as well.

set -e

if [ -z "$ICE_HOME" ]; then
  export ICE_HOME=/usr/share/Ice
fi

# Clean up
clean()
{
    ./build.py clean
}

build_java()
{
    TEST="-p" ./build.py build-default test-compile
}

build_python()
{
    flake8 -v components/tools/OmeroPy/src/omero/plugins
    flake8 -v components/tools/OmeroPy/test/integration/clitest
    flake8 -v components/tools/OmeroPy/test/unit
    ./build.py build-default
    ./build.py -py test -Dtest.with.fail=true
}

for arg in "$@"
do
    case $arg in
        clean)
            clean ;;
        build-java)
            build_java ;;
        build-python)
            build_python ;;
        *)
            echo "Invalid argument: \"$arg\"" >&2
            exit 1
            ;;
    esac
done

exit 0
