{% extends "webadmin/base.html" %}
{% load i18n %}


{% comment %}
<!--
  Copyright (C) 2011 University of Dundee & Open Microscopy Environment.
  All rights reserved.

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
{% endcomment %}

{% block link %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "webadmin/css/picklist.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% static '3rdparty/jquery.chosen/chosen.css' %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% static 'webadmin/css/chosen.css' %}" type="text/css" media="screen"/>
{% endblock %}

{% block title %}
{% if gid %}
    {% trans "Edit group" %}
{% else %}
    {% trans "Add group" %}
{% endif %}
{% endblock %}

{% block script %}
    {{ block.super }}
    <script type="text/javascript" src="{% static '3rdparty/jquery.chosen/chosen.jquery.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function() 
            {
                var highlightDefaultGroup = function() {
                    var experimenterDefaultIds = [{{ experimenterDefaultGroups }}];
                    var selected = $.grep($('#id_members').data('chosen').results_data, function(item){
                        if ($.inArray(parseInt(item.value), experimenterDefaultIds) > -1) {
                            $("#id_members_chzn_c_"+item.array_index).addClass('search-choice-default').find("a").first().unbind("click").remove();                            
                        }
                    });
                }
                
                $("#id_owners").chosen();
                $("#id_members").chosen();
                
                highlightDefaultGroup();
                
                {% if gid %}
                {% ifnotequal permissions 0 %}
                    $('#id_permissions_0').attr('disabled', true);
                {% endifnotequal %}
                {% endif %}

        })
    </script>

{% endblock %}

{% block center_details %}

{{ block.super }}

<div class="one_column_content">
{% if gid %}
    <h1>{% trans "Edit group" %}</h1>
{% else %}
    <h1>{% trans "Add group" %}</h1>
{% endif %}

<h1><a href="{% url wagroups %}" style="position:relative; top:-38px; float:right" title="Go Back to Groups">Cancel</a></h1>


{% if gid %}
<form action="{% url wamanagegroupid "save" gid %}"  class="standard_form settings_form" method="POST">
{% else %}

<form class="standard_form settings_form" action="{% url wamanagegroupid "create" %}" method="POST">
{% endif %}

<p>{% trans "Fields marked in red are mandatory." %}</p>


    {% for field in form %}
        
		{% if field.field.required %}<span class="required">{{ field.label_tag }}</span>{% else %}{{ field.label_tag }}{% endif %}
		{{ field }}
		
		{% if field.errors %}{{ field.errors }}{% endif %}
		
		{{ field.help_text|safe }}
	<br/>
    
    {% endfor %}  
    
  <input type="submit" value="{% trans 'Save' %}" />

</form>


<p>{% trans "<strong>Private (rw----)</strong>: All data in this group is only visible to the user who owns it and the group owner. Other users cannot see who else is in the group or view their data. The group owner can view the data for other group members but not make any edits (same as read-only behaviour)." %}</p>

<p>{% trans "<strong>Collaborative - read-only (rwr---)</strong>: Users in groups with this permission setting can view each others' data, but cannot edit or annotate another user's data. You can view another users' images but not comment, rate or tag their images." %}</p>

<p>{% trans "<strong>Collaborative - read-annotate (rwra--)</strong>: Users in a collaborative group can view and annotate the data belonging to other users. You can tag another user's images or use their tags to annotate your own images. You can add comments to their images and save your own rendering settings for each image. However, you cannot edit the names of their images, projects, datasets or tags etc." %}</p>

<div class="error"><p>{% trans "<strong>WARNING</strong>: It is not possible to <strong>reduce</strong> permissions to <strong>Private</strong>. Once links have been created in the database under <strong>Collaborative</strong> permissions, these cannot be severed. However, it is possible to <strong>promote</strong> a Private group to be Collaborative or Read-only group. " %}</p></div>

</div>

{% endblock %}
