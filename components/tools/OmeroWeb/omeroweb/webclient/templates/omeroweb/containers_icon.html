{% extends "omeroweb/base.html" %}
{% load i18n %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% url webstatic "css/annotation.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/thickbox.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/slider.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/tree.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/googiespell.css" %}" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% url webstatic "javascript/jquery_1.2.6.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.quicksearch.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.core.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.draggable.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.droppable.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.resizable.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.slider.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.tabs.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/effects.core.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/ui/effects.highlight.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/AJS.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/googiespell.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/cookiesupport.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/thickbox/thickbox.js" %}"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% url webstatic "javascript/menu.js" %}"></script> 
    <script type="text/javascript" src="{% url webstatic "javascript/basket.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/slider.js" %}"></script> 
    
    <script>

        $(document).ready(function(){
            {% if manager.c_size %}
            $('ul#products li.product').quicksearch({
                attached: "div#view",
                position: "before",
                stripeRowClass: null,
                labelText: '{% trans "Filter" %}:',
                inputText: '...',
                loaderImg: '{% url webstatic "images/tree/spinner.gif" %}'
            });
            {% endif %}
            
            $("a.loadData").click(function()
            {
                $("div#hierarchy").html('<p>{% trans "Loading hierarchy... please wait" %} <img src ="{% url webstatic "images/tree/spinner.gif" %}"/></p>');
                $("div#hierarchy").load(
                    {% if manager.project or manager.dataset %}
                        {% if manager.dataset %}
                            "{% url manage_container_hierarchies_id "dataset" manager.dataset.id %}", 
                        {% endif %}
                        {% if manager.project %}
                            "{% url manage_container_hierarchies_id "project" manager.project.id %}", 
                        {% endif %}
                    {% else %}
                        "{% url manage_container_hierarchies %}", 
                    {% endif %}
                    function() {  
                        $("a.loadData").remove();                        
                    });
                return false; 
            });
            $("a.loadAnnotation").click(function()
            {
                $("div#annotation").html('<p>{% trans "Loading annotations... please wait" %} <img src ="{% url webstatic "images/tree/spinner.gif" %}"/></p>');
                $("div#annotation").load(
                    {% if manager.dataset %}
                        "{% url manage_annotations "dataset" manager.dataset.id %}", 
                    {% endif %}
                    {% if manager.project %}
                        "{% url manage_annotations "project" manager.project.id %}", 
                    {% endif %}
                    function() {  
                        $("a.loadAnnotation").remove();                        
                    });
                return false; 
            });
            
            $("#annotation_tabs").tabs();
            
        });
    </script>
    <script>
    var popup = function (url) {
          window.open(url,'_blank','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=1000,height=800');
          return false;
    }
    </script>
    
{% endblock %}

{% block center %}

{% if form_users %}
<div class="box">
    {% for field in form_users %}{{ field.label_tag }} {{ field }} <br/>{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}

<!--{% if form_mygroups %}
<div class="box">&nbsp;
    {% for field in form_mygroups %}{{ field.label_tag }} {{ field }}{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}-->

<div class="clear"></div>

{% if manager.dataset %}
    <div class="dataset"><h1>Dataset: {{ manager.dataset.fullNameWrapped }} {% if not manager.dataset.isOwned %}<img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}</h1>
    </div>
{% else %}
    {% if manager.project %}
        <div class="project"><h1>Project: {{ manager.project.fullNameWrapped }} {% if not manager.project.isOwned %}<img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}</h1>
        </div>
    {% endif %}
{% endif %}

{% if manager.dataset %}
    <div class="toolbar">
        {% if manager.dataset.isOwned %}<!--| <a href="#" onclick="toBasket('dataset', '{{ manager.dataset.id }}'); return false;">{% trans "Select" %} <img src="{% url webstatic "images/basket16.png" %}" alt="b" title="add to basket"/></a>--> 
        | <a href="#" onclick="copyToClipboard('dataset', '{{ manager.dataset.id }}'); return false;">{% trans "Copy" %} <img src="{% url webstatic "images/eclipse_copy_edit16.png" %}" alt="c" title="copy"/></a> 
        | <a href="#" onclick="pasteFromClipboard('dataset', '{{ manager.dataset.id }}', '{{ url }}'); return false;">{% trans "Paste" %} <img src="{% url webstatic "images/eclipse_paste_edit16.png" %}" alt="p" title="paste"/></a> 
        | <a href="{% url manage_action_containers "edit" "dataset" manager.dataset.id %}?url={{url}}">{% trans "Edit" %} <img src="{% url webstatic "images/color_line16.png" %}" alt="e" title="edit"/></a> {% endif %}
        | <a href="#annotation_form">{% trans "Annotate" %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotate"/></a> |
    </div>
    
    <div class="clear"></div>
    <div><p>{{ manager.dataset.description|default_if_none:"no description"|wikify|safe|linebreaks }}</p></div>
    
    <div class="separate70"></div>
{% else %}
    {% if manager.project %}
        <div class="toolbar">
            {% if manager.project.isOwned %}| <a href="#" onclick="pasteFromClipboard('project', '{{ manager.project.id }}', '{{ url }}'); return false;">{% trans "Paste" %} <img src="{% url webstatic "images/eclipse_paste_edit16.png" %}" alt="p" title="paste"/></a> 
            | <a href="{% url manage_action_containers "edit" "project" manager.project.id %}/?url={{url}}">{% trans "Edit" %} <img src="{% url webstatic "images/color_line16.png" %}" alt="e" title="edit"/></a> {% endif %}
            | <a href="#annotation_form">{% trans "Annotate" %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotate"/></a> |
        </div>
        
        <div class="clear"></div>
        <div><p>{{ manager.project.description|default_if_none:"no description"|wikify|safe|linebreaks }}</p></div>
        
        <div class="separate70"></div>
    {% endif %}
{% endif %}


<div class="clear"></div>

{% if manager.c_size %}
    {% if manager.experimenter %}
        <h1 id="data">{{ manager.experimenter.getFullName }}'s ({{ manager.c_size }} items):</h1>
    {% else %}
        <h1 id="data">{% trans "My data" %} ({{ manager.c_size }} {% trans "items" %}):</h1>
    {% endif %}
{% else %}
    {% ifequal nav.menu 'mydata' %}
        <h1>{% trans "My data (no items)" %}:</h1>
    {% else %}
        <h1>{% trans "No items" %}:</h1>
    {% endifequal %}
{% endif %}

<div id="view"> 
    {% ifequal nav.whos "share" %}
        | {% trans "View" %} <a href="{% url manage_shares %}?view=table"><img src="{% url webstatic "images/view_detailed16.png" %}" alt="table" title="table"/></a> <a href="{% url manage_shares %}?view=icon"><img src="{% url webstatic "images/view_icon16.png" %}" alt="icon" title="icon"/></a> |
    {% else %}
        | {% trans "View" %} <a href="{% if manager.project %}{% if manager.dataset.id %}{% url manage_data nav.whos "project" manager.project.id "dataset" manager.dataset.id %}{% else %}{% url manage_data nav.whos "project" manager.project.id %}{% endif %}{% else %}{% if manager.dataset.id %}{% url manage_data nav.whos "dataset" manager.dataset.id %}{% endif %}{% endif %}?view=table"><img src="{% url webstatic "images/view_detailed16.png" %}" alt="details" title="details"/></a> <a href="{% if manager.project %}{% if manager.dataset.id %}{% url manage_data nav.whos "project" manager.project.id "dataset" manager.dataset.id %}{% else %}{% url manage_data nav.whos "project" manager.project.id %}{% endif %}{% else %}{% if manager.dataset.id %}{% url manage_data nav.whos "dataset" manager.dataset.id %}{% endif %}{% endif %}?view=icon"><img src="{% url webstatic "images/view_icon16.png" %}" alt="icon" title="icon"/></a> <a href="{% url manage_data nav.whos %}?view=tree"><img src="{% url webstatic "images/view_tree16.png" %}" alt="tree" title="tree"/></a> |
    {% endifequal %}

{% if not manager.image %}
    {% if not manager.dataset %}
        {% if manager.project and manager.project.isOwned %}
            {% trans "New" %} <a href="{% url manage_action_containers "new" "project" manager.project.id %}?url={{url}}"><img src="{% url webstatic "images/window_new16.jpg" %}" alt="new" title="new" /></a> | 
        {% else %}
            {% trans "New" %} <a href="{% url manage_action_containers "new" %}?url={{url}}"><img src="{% url webstatic "images/window_new16.jpg" %}" alt="new" title="new" /></a> | 
        {% endif %}
    {% endif %}
{% endif %}
</div>

<div class="slider">
    <div class="slider_products"> 
        <div class="slider_text">{% trans "Zoom" %}:</div>
        <div class='small_label'></div> 
        <div class='slider_bar'> 
            <div id="slider_callout"></div> 
            <div id='slider1_handle' class='slider_handle'></div> 
        </div> 
        <div class='large_label'></div> 
    </div>
</div>

<div class="clear"> </div>

{% if not manager.c_size %}
    {% trans "No data." %}
{% else %}
    {% if manager.c_size %}
    <ul id="products">
        {% for c in manager.containers.projects %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}<a href="{% url manage_data "mydata" "project" c.id %}?view=icon"><img id="{{ c.id }}" class="catzoom" src="{% url webstatic "images/folder64.png" %}" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% url manage_data "userdata" "project" c.id %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% url webstatic "images/folder64.png" %}" title="{{ c.name }}" alt="project"/></a>{% endif %}
            <div class="center"><img src="{% url webstatic "images/folder_image12.png" %}" title="image" alt="image"/>[{{ c.countChild }}]{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes12.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</div>
            <div class="center">{{ c.tinyName }}</div>
        </li>
        {% endfor %}
        {% for c in manager.containers.datasets %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}<a href="{% if manager.project %}{% url manage_data "mydata" "project" manager.project.id "dataset" c.id %}{% else %}{% url manage_data "mydata" "dataset" c.id %}{% endif %}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_image64.png" %}" title="{{ c.name }}" alt="dataset"/></a>{% else %}<a href="{% if manager.project %}{% url manage_data "userdata" "project" manager.project.id "dataset" c.id %}{% else %}{% url manage_data "userdata" "dataset" c.id %}{% endif %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% url webstatic "images/folder_image64.png" %}" title="{{ c.name }}" alt="dataset"/></a>{% endif %}
            <div class="center"><img src="{% url webstatic "images/image12.png" %}" title="image" alt="image"/>[{{ c.countChild }}]{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes12.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</div>
            <div class="center">{{ c.tinyName }}</div>
            <div class="center">{% if c.isOwned %}<a href="#" onclick="copyToClipboard('dataset', '{{ c.id }}'); return false;"><img src="{% url webstatic "images/eclipse_copy_edit12.png" %}" alt="c" title="copy"/></a>{% if manager.project %} <a href="{% url manage_action_containers "remove" %}?parent=pr-{{ manager.project.id }}&source=ds-{{ c.id }}&url={{ url }}" onClick="return confirm('Unlink dataset?');"><img src="{% url webstatic "images/cut12.png" %}" alt="u" title="unlink"/></a>{% endif %}{% endif %}</div>
        </li>
        {% endfor %}
        {% for c in manager.containers.images %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}<a href="{% if manager.project %}{% url manage_data "mydata" "project" manager.project.id "dataset" manager.dataset.id "image" c.id %}{% else %}{% if manager.dataset %}{% url manage_data "mydata" "dataset" manager.dataset.id "image" c.id %}{% else %}{% url manage_data "mydata" "image" c.id %}{% endif %}{% endif %}"><img id="{{ c.id }}" class="imgzoom" src="{% url render_thumbnail c.id %}" alt="image" title="{{ c.name }}"/></a>{% else %}<a href="{% if manager.project %}{% url manage_data "userdata" "project" manager.project.id "dataset" manager.dataset.id "image" c.id %}{% else %}{% if manager.dataset %}{% url manage_data "userdata" "dataset" manager.dataset.id "image" c.id %}{% else %}{% url manage_data "userdata" "image" c.id %}{% endif %}{% endif %}"><img id="{{ c.id }}" class="imgzoom" src="{% url render_thumbnail c.id %}" alt="image" title="{{ c.name }}"/></a>{% endif %}
            <div class="center">{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes12.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</div>
            <div class="center">{{ c.tinyName }}</div>
            <div class="center"><a href="#" onclick="return popup('{% url image_viewer c.id %}')"><img src="{% url webstatic "images/kview12.png" %}" alt="v" title="view"/></a><a href="{% url manage_image_zoom c.id %}?keepThis=true&TB_iframe=true&height=500&width=860" alt="{{ c.shortName }}" class="thickbox" rel="gallery-omero" title="{{ c.shortName }} by {{ c.getOwnerFullName }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% url webstatic "images/kpresenter12.png" %}" alt="p" title="presentation"/></a>{% if c.isOwned %} <a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"> <img src="{% url webstatic "images/basket12.png" %}" alt="b" title="add to basket"/></a> <a href="#" onclick="copyToClipboard('image', '{{ c.id }}'); return false;"><img src="{% url webstatic "images/eclipse_copy_edit12.png" %}" alt="c" title="copy"/></a>{% if manager.dataset %} <a href="{% url manage_action_containers "remove" %}?parent=ds-{{ manager.dataset.id }}&source=img-{{ c.id }}&url={{ url }}" onClick="return confirm('Unlink image?');"><img src="{% url webstatic "images/cut12.png" %}" alt="u" title="unlink"/></a>{% endif %}{% endif %}</div>
        </li>
        {% endfor %}
        
        {% if not manager.project and not manager.dataset %}
        {% if not manager.orphaned %}
        <li class="product"><em>{% trans "Orphaned images" %}</em>
            <a href="{% url manage_data_orphaned nav.whos "orphaned" %}"><img class="catzoom" src="{% url webstatic "images/folder_yellow64.png" %}" title="Orphaned images" alt="project"/></a><div class="center">{% trans "Orphaned images" %}</div>
        </li>
        {% endif %}
        {% endif %}
    </ul>
    
    {% include "omeroweb/container_paging.html" %}
    
    {% endif %}

{% endif %}

<div class="clear"> </div>

<div class="separate70"></div>

{% if manager.project or manager.dataset %}

<div id="annotation">
<h1>{% trans "Annotations" %}:</h1>
{% if manager.dataset %}
    {% if manager.dataset.countAnnotations %}<a href="#" class="loadAnnotation">{% trans "Show annotations associated with" %}... [{{ manager.dataset.countAnnotations }}]</a>
    {% endif %}
{% else %}
    {% if manager.project %}
        {% if manager.project.countAnnotations %}<a href="#" class="loadAnnotation">{% trans "Show annotations associated with" %}... [{{ manager.project.countAnnotations }}]</a>{% endif %}
    {% endif %}
{% endif %}
</div>

{% include "omeroweb/annotations_form.html" %}
<div class="clear"> </div>

<div>
    {% if manager.dataset %}
        <h1>{% trans "Where this dataset is is linked?" %}</h1>
    {% else %}
        {% if manager.project %}<h1>{% trans "Where this project is linked?" %}</h1>{% endif %}
    {% endif %}
    <a href="#" class="loadData">{% trans "Show the hierarchy structure" %}...</a></div>
<div id="hierarchy"> </div>

{% endif %}
{% endblock %}

{% block advice %}
    {% include "omeroweb/advice.html" %}
{% endblock %}