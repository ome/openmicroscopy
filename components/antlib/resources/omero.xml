<?xml version="1.0" encoding="utf-8"?>
<project name="omero" default="usage" basedir=".">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# Copyright (C) 2005 Open Microscopy Environment
#       Massachusetts Institue of Technology,
#       National Institutes of Health,
#       University of Dundee    
#                       
#               
#
#    This library is free software; you can redistribute it and/or
#    modify it under the terms of the GNU Lesser General Public
#    License as published by the Free Software Foundation; either
#    version 2.1 of the License, or (at your option) any later
#    version.           
#                       
#    This library is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#    Lesser General Public License for more details.
#       
#    You should have received a copy of the GNU Lesser General Public
#    License along with this library; if not, write to the Free
#    Software           
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
#    02111-1307  USA
#       
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore <josh.moore@gmx.de>
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        
  DOCUMENTATION:
  ==============================================================================
  This is the main build script for binary distributions and replaces the 
  main build script (OMERO_HOME/build.xml) in the OMERO_HOME/dist directories. 

-->

	<!-- TODO: need to get /etc working -->
        <property name="omero.repo.local" value="lib/repository"/>
	<property file="etc/omero.properties"/>
	<property file="etc/hibernate.properties"/>

	<import file="components/antlib/resources/global.xml"/>

	<path id="generated.compile.classpath">
		<pathelement path="${omero.home}/etc"/>
		<fileset dir="${omero.home}">
			<include name="client/*.jar"/>
			<include name="lib/repository/groovy/**/*.jar"/>
			<include name="lib/repository/omero/postgresql/**/*.jar"/>
		</fileset>
	</path>

	<path id="generated.test.classpath">
		<path refid="generated.compile.classpath"/>
	</path>

	<path id="omero.classpath">
		<path refid="generated.compile.classpath"/>
	</path>

	<target name="usage"
		description="Usage information">
		<concat>
			<filelist dir="${import.dir}" files="usage-omero.txt"/>
		</concat>
	</target>

	<target name="update">
		<jar update="true"
		  destfile="${omero.home}/omero-app-${omero.version}.ear">
			<fileset dir="${etc.dir}">
				<include name="omero.properties"/>
				<include name="hibernate.properties"/>
			</fileset>
		</jar>
	</target>

	<target name="setup-db">
		<sql_run>
  			<transaction src="sql/ddl.sql"/>
  			<transaction src="sql/data.sql"/>
		</sql_run>
	</target>

	<target name="earfiles">
		<fileset dir="${omero.home}" includes="*.ear" id="ear.files"/>
	</target>
	<target name="deploy" depends="deploy-ear-jboss"/>

	<target name="check" depends="classpath-define,load-groovy">

		<groovy classpathRef="generated.compile.classpath">
		println System.getProperty("java.class.path")
		sf = new ome.system.ServiceFactory()
		p = sf.getPojosService()

		s = new HashSet()
		s.add(new Long(1))
		s.add(new Long(5588))

		r = p.findCGCPaths(s,ome.api.IPojos.CLASSIFICATION_ME,None)
		</groovy>
	</target>
</project>

